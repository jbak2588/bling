### Bling App: AI 검수 시스템 V2 초기 버전 개발 성공 DevLog

**날짜:** 2025년 10월 20일 **버전:** v2.0.0-alpha **상태:** 신규/수정 상품에 대한 AI 리포트 생성 및 저장 기능 구현 완료

V1 프로토타입의 한계를 극복하기 위해 시작된 AI 검수 시스템 V2의 초기 버전 개발이 성공적으로 완료되었다. 이번 버전의 핵심 목표는 AI가 상품의 **'맥락'**을 이해하도록 하여, 더 정확하고 유용한 검수 리포트를 생성하는 것이었다. 수많은 시행착오 끝에, 아래와 같은 핵심적인 개선을 통해 목표를 달성할 수 있었다.

#### **1. 데이터 기반 재설계: `categories_v2`의 완성**

V1의 가장 큰 문제였던 일관성 없는 카테고리 구조를 전면 개편했다. `parentId`를 이용한 2단계 구조의 `categories_v2` 컬렉션을 성공적으로 구축했으며, 이는 AI에게 '대분류'와 '소분류'라는 명확한 맥락을 제공하는 핵심 기반이 되었다.

#### **2. 프롬프트와 서버의 진화: 진정한 V2 시스템 구축**

- **`ai_rule_uploader.dart`:** V1의 복잡한 카테고리별 규칙을 모두 폐기하고, 어떤 상품이든 처리할 수 있는 **`generic_v2` 범용 규칙** 하나만을 사용하도록 단순화했다. 프롬프트는 `{{categoryName}}`과 `{{subCategoryName}}` 변수를 포함하도록 수정되어, 서버로부터 맥락 정보를 주입받을 준비를 마쳤다.
    
- **`index.js` (Cloud Functions):** 가장 큰 변화가 있었던 부분이다. `generatefinalreport` 함수가 프론트엔드로부터 `categoryName`, `subCategoryName`을 전달받아, AI 프롬프트의 변수를 실제로 치환하는 로직을 추가했다. 이로써 서버는 비로소 AI에게 "이 상품은 디지털 기기 카테고리의 스마트폰이다"와 같은 구체적인 명령을 내릴 수 있게 되었다.
    

#### **3. 프론트엔드 파이프라인 완성: 데이터의 흐름을 잇다**

- **`product_registration_screen.dart` / `product_edit_screen.dart`:** 두 화면 모두 AI 검수 시작 시, `categories_v2`를 조회하여 선택된 카테고리의 대/소분류 이름을 가져오고, 이 정보를 백엔드로 전달하는 데이터 파이프라인을 구축했다. 또한, AI 규칙(`generic_v2`)의 `requiredShots`이 비어있을 경우, 불필요한 `ai_evidence_collection_screen`을 건너뛰고 바로 최종 보고서를 생성하도록 '스마트 분기 로직'을 구현하여 UX를 개선했다.
    
- **`ai_final_report_screen.dart`:** AI가 생성한 최종 리포트를 받아와 사용자가 편집하고, 안정적인 `ProductModel`을 사용하여 모든 필수 정보(userId, locationParts 등)를 포함하여 Firestore에 저장하는 최종 단계 로직을 완성했다.
    

**결과:** 신규 상품 등록과 기존 상품 수정 양쪽 모두에서, 사용자가 선택한 카테고리 정보를 바탕으로 AI가 맥락을 이해하고 생성한 검수 리포트가 성공적으로 상품 상세 정보에 반영되는 것을 확인했다. 이는 V2 개발의 중요한 마일스톤이다.