대답:121

보스, 알겠습니다. 작업 요청 120번에서 재수립한 **"동적 증거 보강 시스템 (V2.1)"** 개발 계획을, 실행 가능한 작업 항목 리스트로 정리하여 보고드립니다.

### 동적 증거 보강 시스템 (V2.1) 도입

- **핵심 목표:** V1의 경직된 '필수 샷' 요구 방식에서 벗어나, AI가 1차 분석을 통해 **부족한 증거를 동적으로 파악**하고 판매자에게 **선택적인 보강 기회**를 제공하는, 진정한 범용 시스템을 구축한다.
    
- **개발 진행 리스트:**
    
    1. **1단계: AI의 '결정적 증거' 분석 기능 추가 (백엔드 및 데이터 모델 수정)**
        
        - **`ai_verification_rule_model.dart` 수정:** `requiredShots` 필드를 `suggestedShots` 필드로 대체합니다. 이 필드는 "스마트폰이라면 IMEI, 배터리 성능샷이 있으면 신뢰도가 높아진다"와 같은 **카테고리별 '추천 증거' 목록**을 정의합니다.
            
        - **`index.js` 수정:** `generatefinalreport` 함수를 **2단계 분석**이 가능하도록 변경합니다.
            
            - **1차 호출 (분석 단계):** 앱에서 상품의 기본 이미지와 카테고리 ID를 받습니다. 서버는 해당 카테고리의 `suggestedShots` 목록을 참고하여, AI에게 "이 추천 증거 목록 중, 사용자가 제공한 사진에서 확인할 수 _없는_ 항목이 무엇인가?"를 질문하고, 그 결과(`missing_evidence_list`)를 앱으로 반환합니다.
                
    2. **2단계: 판매자를 위한 '증거 보강 제안' UI 구현 (프론트엔드 신규 화면)**
        
        - `product_registration_screen` 등에서 AI 검수 시작 시, `ai_evidence_collection_screen` 대신 새로운 **`ai_evidence_suggestion_screen.dart`** 화면으로 이동합니다.
            
        - 이 화면은 서버로부터 받은 `missing_evidence_list`를 사용자에게 보여주며 (예: "배터리 성능 화면을 추가하면 신뢰도가 더 높아집니다."), 각 제안에 대해 **[사진 추가]** 또는 **[건너뛰기]** 버튼을 제공합니다.
            
    3. **3단계: 최종 리포트 생성 로직 강화 (백엔드 및 데이터 모델 수정)**
        
        - `ai_evidence_suggestion_screen`에서 사용자가 모든 선택을 마치면, 보강된 사진과 '건너뛴 항목' 목록을 포함하여 `generatefinalreport` 함수를 **2차 호출(생성 단계)**합니다.
            
        - **`index.js` 수정:** 2차 호출 시, AI에게 모든 사진(기본+보강)과 '건너뛴 항목' 목록을 전달하며 최종 리포트 생성을 지시합니다. 이때 프롬프트에 "만약 '건너뛴 항목'이 있다면, 최종 리포트에 **'구매자 참고사항(`notes_for_buyer`)'** 필드를 추가하고, '[건너뛴 항목]은 판매자가 직접 인증하지 않았으므로 구매 시 확인을 권장합니다'라는 문구를 포함시켜라"는 조건을 명시합니다.
            
        - **`product_model.dart` 수정:** Firestore에 저장될 `aiReport` 맵에 `notes_for_buyer` 필드를 추가할 수 있도록 모델을 확장합니다.
            
    4. **4단계: 구매자를 위한 '확인 필요' 알림 UI 구현 (프론트엔드 수정)**
        
        - **`product_detail_screen.dart` 수정:** 상품 상세 보기 화면에서, `product.aiReport`에 `notes_for_buyer` 필드가 존재할 경우, AI 검증 뱃지 옆에 경고 아이콘과 함께 해당 내용을 눈에 띄게 표시합니다. (예: ⚠️ _배터리 성능은 판매자가 직접 인증하지 않았습니다._)

---

### AI 검수 V2.1: 동적 증거 보강 시스템 개발 계획 리스트

- **핵심 목표:** AI가 1차 분석을 통해 부족한 증거를 동적으로 파악하고 판매자에게 선택적인 보강 기회를 제공하며, 그 결과를 구매자에게 투명하게 공개하는 지능형 검수 시스템을 구축한다.
    
- **개발 진행 리스트:**
    
    1. **✅ (다음 작업) 작업 #122: 데이터 모델 및 규칙 재설계**
        
        - **파일:** `ai_verification_rule_model.dart`, `ai_rule_uploader.dart`
            
        - **내용:**
            
            - `AiVerificationRule` 모델의 `requiredShots` 필드를, '추천 증거' 목록을 정의하는 `suggestedShots` (타입: `Map<String, RequiredShot>`) 필드로 변경합니다.
                
            - `ai_rule_uploader.dart`를 수정하여, '스마트폰' 카테고리 전용 규칙을 생성합니다. 이 규칙의 `id`는 `smartphone-tablet`으로 하고, `suggestedShots`에 'IMEI 화면', '배터리 성능 화면' 등을 '추천' 항목으로 추가합니다.
                
    2. **✅ 작업 #123: 1차 분석 백엔드 로직 구현**
        
        - **파일:** `index.js`
            
        - **내용:**
            
            - `initialproductanalysis` 함수(또는 새로운 함수)를 수정합니다.
                
            - 앱으로부터 받은 상품의 기본 이미지와 카테고리 ID를 기반으로, 해당 카테고리의 `suggestedShots` 목록과 이미지들을 AI에게 전달합니다.
                
            - AI에게 "이 추천 증거 목록 중, 제공된 사진에서 내용을 확인할 수 없는 항목의 key 목록을 반환하라"고 요청합니다.
                
            - AI의 답변(`missing_evidence_list`)을 앱으로 반환하는 로직을 구현합니다.
                
    3. **✅ 작업 #124: 증거 보강 제안 UI 신규 개발**
        
        - **파일:** `lib/features/marketplace/screens/ai_evidence_suggestion_screen.dart` (신규 생성)
            
        - **내용:**
            
            - `product_registration_screen` 등에서 AI 검수 시작 시, 이 새로운 화면으로 이동하도록 연결합니다.
                
            - 이 화면은 서버로부터 받은 `missing_evidence_list`를 기반으로 사용자에게 "다음 사진을 추가하면 신뢰도가 높아집니다"와 같은 제안 목록을 보여줍니다.
                
            - 각 제안 항목마다 `[사진 추가]` 버튼과 `[건너뛰기]` 버튼을 구현합니다.
                
            - 사용자가 모든 제안에 대해 선택(사진 추가 또는 건너뛰기)을 완료하면, 추가된 사진과 '건너뛴 항목'의 key 목록을 가지고 다음 단계로 진행합니다.
                
    4. **✅ 작업 #125: 최종 리포트 생성 백엔드 로직 강화**
        
        - **파일:** `index.js`, `product_model.dart`
            
        - **내용:**
            
            - `generatefinalreport` 함수를 수정하여, `ai_evidence_suggestion_screen`으로부터 보강된 사진들과 '건너뛴 항목' 목록(`skipped_items`)을 추가로 전달받습니다.
                
            - AI에게 최종 프롬프트를 보낼 때, `skipped_items` 목록이 비어있지 않다면, AI 리포트 JSON에 `notes_for_buyer` 필드를 추가하고 "구매 시 [항목명] 확인을 권장합니다" 와 같은 경고 문구를 포함하도록 지시합니다.
                
            - `product_model.dart`의 `aiReport` 필드가 `notes_for_buyer` 키를 포함할 수 있도록 합니다.
                
    5. **✅ 작업 #126: 구매자 알림 UI 구현**
        
        - **파일:** `product_detail_screen.dart`
            
        - **내용:**
            
            - AI 검증 상품을 표시할 때, `product.aiReport` 맵에 `notes_for_buyer` 필드가 존재하는지 확인합니다.
                
            - 해당 필드가 존재할 경우, AI 검증 뱃지 주변에 경고 아이콘(⚠️)과 함께 `notes_for_buyer`의 내용을 눈에 띄게 표시하는 UI 로직을 추가합니다.
                

이 순서대로 작업을 진행하여, V2.1 시스템을 완성하겠습니다.

대답:121 완료