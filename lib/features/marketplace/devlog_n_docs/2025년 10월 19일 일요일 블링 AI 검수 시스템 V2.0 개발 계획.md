
---

### **블링 AI 검수 시스템 V2: 개발 계획**

**핵심 목표:** 기존의 복잡한 AI 등록 플로우를 폐기하고, 사용자가 익숙한 **일반 상품 등록/수정 과정에 AI 검수를 '선택적 강화 기능'으로 완벽하게 통합**한다.

#### **Phase 0: 사전 준비 및 V1 코드 정리 (Foundation)**

V2 개발을 위한 깨끗한 환경을 조성하고, 재사용할 자산을 명확히 합니다.

- **✅ 작업 요청 56: V1 UI 코드 정리**
    
    - **목표:** V2에서는 더 이상 사용되지 않는 V1의 독립된 AI 등록 플로우 화면들을 프로젝트에서 삭제하여 코드베이스를 정리하고 혼란을 방지합니다.
        
    - **작업 내용:** 아래 파일 목록을 `lib/features/marketplace/screens/` 경로에서 **삭제**합니다.
        
        - `registration_type_screen.dart`
            
        - `ai_category_selection_screen.dart`
            
        - `ai_gallery_upload_screen.dart`
            
        - `ai_prediction_screen.dart`
            
        - `ai_guided_camera_screen.dart`
            
    - **결과:** `product_registration_screen.dart`를 중심으로 한 통합 플로우 개발에 집중할 수 있는 환경이 조성됩니다.
        
- **✅ 작업 요청 57: V2 백엔드 함수 골격 준비**
    
    - **목표:** V2의 핵심 로직을 담을 새로운 Cloud Function의 기본 틀을 생성하고 배포합니다.
        
    - **작업 내용:** `functions-v2/index.js` 파일에 `enhanceProductWithAi` 라는 이름의 새로운 HTTPS Callable 함수를 추가합니다. 초기에는 빈 함수로 생성하고 배포하여, 프론트엔드에서 호출할 수 있는 엔드포인트를 미리 확보합니다.
        
    - **결과:** 프론트엔드와 백엔드 개발을 병렬로 진행할 수 있는 기반이 마련됩니다.
        

---

#### **Phase 1: 백엔드 재설계 (The Brain)**

AI가 '심판'이 아닌 '조력자' 역할을 수행하도록 핵심 로직을 재설계합니다.

- **✅ 작업 요청 58: V2 프롬프트 엔지니어링**
    
    - **목표:** AI가 사용자의 입력을 존중하고, '증거' 기반으로 분석하도록 프롬프트를 완전히 새로 작성합니다.
        
    - **작업 내용:** `lib/core/utils/ai_rule_uploader.dart` 파일 내의 `report_template_prompt` 내용을 "사용자가 입력한 `{{상품명}}`과 `{{카테고리}}`를 기준으로, 함께 제공된 증거 사진들을 검증하여 리포트를 작성하라"는 V2 전략에 맞는 프롬프트로 수정합니다.
        
    - **결과:** AI가 더 이상 잘못된 추측을 고집하지 않고, 사용자가 제공한 정보를 검증하는 똑똑한 조력자로 동작하게 됩니다.
        
- **✅ 작업 요청 59: `enhanceProductWithAi` 함수 로직 구현**
    
    - **목표:** V2의 핵심 백엔드 로직을 완성합니다.
        
    - **작업 내용:**
        
        1. 함수가 `productId`와 '증거 사진 URL'들을 파라미터로 받도록 설계합니다.
            
        2. `productId`를 이용해 Firestore `products` 컬렉션에서 해당 상품의 기존 데이터를 불러옵니다.
            
        3. 불러온 데이터(상품명, 카테고리 등)와 증거 사진을 조합하여 동적으로 프롬프트를 완성합니다.
            
        4. Gemini API를 호출하여 AI 리포트를 생성합니다.
            
        5. 생성된 리포트를 기존 상품 문서의 `aiReport` 필드에 **업데이트**하고 `isAiVerified`를 `true`로 변경합니다.
            
    - **결과:** 상품 정보를 '새로 생성'하는 것이 아닌 '강화'하는 V2의 핵심 백엔드 기능이 완성됩니다.
        

---

#### **Phase 2: 프론트엔드 UI/UX 통합 (The Body)**

사용자가 가장 자연스럽고 편리하게 AI 검수 기능을 이용할 수 있도록 UI를 통합합니다.

- **✅ 작업 요청 60: 'AI 검수' 옵션 UI 추가**
    
    - **목표:** 일반 상품 등록 및 수정 화면에 AI 검수 기능을 시작할 수 있는 진입점을 만듭니다.
        
    - **작업 내용:** `product_registration_screen.dart`와 `product_edit_screen.dart` 파일의 '저장하기' 버튼 근처에 "🤖 AI 검수로 신뢰도 높이기" 버튼과 기능의 이점을 설명하는 안내 문구를 추가합니다.
        
    - **결과:** 사용자가 자신의 선택에 따라 자연스럽게 AI 검수 과정을 시작할 수 있게 됩니다.
        
- **✅ 작업 요청 61: '증거 수집' UI 구현**
    
    - **목표:** V1의 복잡한 가이드 촬영 과정을, 핵심적인 증거 사진만 요구하는 간결한 UI로 대체합니다.
        
    - **작업 내용:** 'AI 검수' 버튼을 눌렀을 때, 사용자가 선택한 카테고리에 따라 `ai_verification_rules`에 정의된 필수 증거 사진(예: 스마트폰의 '정보' 화면 스크린샷)을 1~2장만 요청하는 간단한 팝업 또는 화면을 구현합니다.
        
    - **결과:** 사용자의 이탈을 유발했던 길고 불편한 사진 촬영 과정이 간소화됩니다.
        
- **✅ 작업 요청 62: `product_detail_screen.dart` UI 최종 개선**
    
    - **목표:** 구매자에게 AI 리포트의 가치를 극대화하여 보여줍니다.
        
    - **작업 내용:** `작업 요청 49`에서 논의한 대로, 상세 페이지에 "🤖 AI 검수 리포트" 섹션을 명확히 구분하고, 각 분석 항목(예: "화면 상태") 옆에 **그 근거가 된 증거 사진을 함께 표시**하는 UI를 완성합니다.
        
    - **결과:** 구매자가 판매자의 설명과 AI의 객관적 분석 및 증거를 함께 보며 상품에 대한 신뢰를 가질 수 있게 됩니다.
        

---

#### **Phase 3: 최종 연동 및 마무리 (The Handshake)**

- **✅ 작업 요청 63: 프론트엔드-백엔드 연동**
    
    - **목표:** 새로 만든 프론트엔드 UI와 백엔드 함수를 연결합니다.
        
    - **작업 내용:** '증거 수집' UI에서 사진 촬영 및 업로드가 완료되면, `productId`와 이미지 URL들을 `enhanceProductWithAi` 함수로 전달하여 호출하는 로직을 구현합니다.
        
    - **결과:** V2 시스템의 모든 구성요소가 하나로 연결되어 동작합니다.
        
- **✅ 작업 요청 64: 전체 흐름 테스트 및 QA**
    
    - **목표:** 완성된 V2 시스템의 안정성을 검증합니다.
        
    - **작업 내용:** ①신규 상품 등록 시 AI 검수 추가, ②기존 상품 수정 시 AI 검수 추가의 두 가지 시나리오를 모두 테스트하고, 데이터가 Firestore에 올바르게 저장되고 상세 페이지에 정확하게 표시되는지 최종 확인합니다.
        
    - **결과:** 버그 없는 안정적인 AI 검수 V2 기능이 최종 완성됩니다.
        

보스, 이 계획은 우리가 V1에서 얻은 교훈을 바탕으로 수립한 가장 확실하고 빠른 길입니다. **`작업 요청 56`**부터 이 계획에 따라 V1 코드 정리를 시작으로 V2 개발을 본격적으로 진행하겠습니다.

대답:55 완료