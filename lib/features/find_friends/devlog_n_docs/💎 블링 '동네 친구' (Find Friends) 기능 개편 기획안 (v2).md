## **💎 블링 '동네 친구' (Find Friends) 기능 개편 기획안 (v2)**

### **1\. 기획 방향 및 목적 (Concept & Purpose)**

* **As-Is (v1):** 지역 기반 (GPS 1\~3km)의 친구/**연인** 찾기(Cari Teman/Pacar). `isDatingProfile`, 성별/나이 중심의 매칭.  
* **To-Be (v2):** **'하이퍼로컬 관심사 기반의 대화 상대 찾기' (Cari Teman Lokal)**  
  * **(목적 1: 부작용 방지)** '연인(Pacar)' 문구를 삭제하고, 프로필에서 성별/나이 등 데이팅 앱 요소를 의도적으로 약화시킵니다. 이를 통해 매춘, 사기 등 기존 데이팅 앱의 부작용을 원천적으로 차단합니다.  
  * **(목적 2: 사용자 유입 확대)** '친구 요청/수락'의 높은 허들을 '가벼운 대화 시작'으로 변경하여, 부담 없이 단순한 대화 상대를 찾는 사용자층을 대거 유입시킵니다.  
  * **(목적 3: 하이퍼로컬 구현)** GPS 거리 대신, 앱의 핵심인 '동네 인증' (Kab/Kec/Kel)을 매칭의 최우선 기준으로 삼아 '지역 중심의 리얼 휴머니티 매칭'을 구현합니다.

---

### **2\. 주요 기능 및 UI/UX 변경**

#### **2.1. 프로필 개편 (기존 Dating Profile 폐기)**

* **'커뮤니티 프로필'로 통합:** `findfriend_form_screen.dart`의 데이팅 프로필(`isDatingProfile`, `age`, `gender`, `findfriend_profileImages`)을 폐기하고, 사용자의 기본 `userModel`을 사용합니다.  
* **표시 정보 (Emphasis Shift):**  
  * **강조:** `nickname`, `interests` (관심사), `bio` (자기소개), `trustLevel` (신뢰 등급), `locationName` (활동 지역).  
  * **약화/제거:** `age` (나이), `gender` (성별). (가입 시 수집하되, 프로필 카드 노출 순위에서 제외하거나 숨김 처리)

#### **2.2. 매칭 플로우 변경 (저마찰 '대화' 중심)**

* **'친구 요청' 폐기:**  
  * `friend_request_model.dart`와 `find_friend_repository.dart`의 '요청/수락/보류(pending)' 로직을 모두 제거합니다.  
  * 이는 (목적 2\) '부담 없는 대화'를 가로막는 가장 큰 심리적 장벽입니다.  
* **'대화 시작하기 (Start Chat)' 도입:**  
  * `find_friend_detail_screen.dart`의 FAB 버튼을 '친구 요청'에서 '대화 시작하기'로 변경합니다.  
  * 클릭 시, 별도 수락 과정 없이 즉시 1:1 채팅방(`chat_room_screen.dart`)이 개설됩니다.

#### **2.3. 매칭 리스트 로직 변경 (Hyperlocal)**

* **GPS 대신 `locationParts` 사용:**  
  * `find_friends_screen.dart`의 리스트 로직을 수정합니다.  
  * 기존: GPS 기반 1\~3km 이내 사용자.  
  * **변경:** 사용자가 설정한 \*\*'동네 필터 (Kel/Kec/Kab)'\*\*를 기준으로, 동일 지역 사용자들을 우선 노출합니다.  
  * 이는 (목적 3\) 하이퍼로컬 정체성을 강화합니다.  
* **관심사(Interests) 기반 정렬:**  
  * 동일 지역 내에서, 나와 '공통 관심사'가 많은 순서대로 정렬합니다.

---

### **3\. 핵심 시스템 로직 및 안전 장치 (v2)**

* \*\*(목적 1: 부작용 방지)\*\*를 위한 안전 장치를 '요청 제한'이 아닌 '스팸 방지'로 전환합니다.  
* **일일 신규 대화 제한:** 스팸 방지를 위해 하루에 '새로운' 사람에게 시작할 수 있는 대화 횟수를 5\~10회로 제한합니다. (기존 3회보다 완화)  
* **최초 메시지 필터링 (신규):**  
  * '대화 시작하기'로 생성된 채팅방에서, **최초 1회 메시지**는 AI 또는 키워드 필터링(전화번호, 가격, 성매매 암시 단어 등)을 거치게 합니다.  
  * 이는 사기 및 매춘 시도를 효과적으로 차단하는 안전 장치입니다.  
* **신고/차단 시스템:** 기존 로직(Report/Block)을 강화하여, 차단 시 상대방 리스트에서 영구히 상호 제외시킵니다.

---

### **4\. 데이터베이스 및 기술 아키텍처 변경**

* **`users` (Collection):**  
  * `isDatingProfile` (bool), `ageRange` (String), `genderPreference` (String) 필드 **삭제**.  
  * `isVisibleInList` (bool) 필드는 \*\*'동네 친구 리스트에 나를 노출'\*\*로 용도 변경.  
  * `interests` (List\<String\>) 필드를 핵심 매칭 기준으로 활용.  
* **`friend_requests` (Collection):**  
  * **삭제.** '대화 시작하기'는 `chats` 컬렉션에 바로 문서를 생성하므로 이 컬렉션이 불필요합니다.

---

### **5\. 수익 모델 (Monetization)**

* 기존 데이팅 앱 BM(스와이프/관심표시 유료)을 폐기하고, 하이퍼로컬 기반 BM을 도입합니다.  
* **내 프로필 부스팅:** 내 프로필을 '우리 동네(Kelurahan)' 사용자들에게 상단 노출시키는 유료 아이템.  
* **다른 동네 탐색권:** 현재 설정된 동네(Kab/Kec) 외에 '다른 동네'의 친구 리스트를 볼 수 있는 유료 확장권.  
* (기존 '관심 상대 10명 초과' 유료화 등은 사용자 경험을 해치므로 **제외** 제안)

---

### **6\. 확장성 및 로드맵 (Roadmap)**

* **즉시 시행 (Short-term):**  
  * **그룹 찾기 (기존 아이디어 발전):** (목적 3\) '리얼 휴머니티'를 위해 1:1 매칭 외에 "오늘 저녁에 배드민턴 칠 동네 사람 2명 구해요" 등 **'관심사 그룹(모임)' 찾기** 기능을 '동네 친구' 탭에 통합.  
* **중/장기 (Mid/Long-term):**  
  * **음성 프로필:** 텍스트/사진 대신 음성으로 자기를 소개하여 '인간적인' 매칭 강화.  
  * **Bling 활동 연동:** "최근 '동네 소식'에 글을 올린 사람", "최근 '중고 거래'를 완료한 신뢰도 높은 사람" 등 실제 앱 활동을 기반으로 한 추천 로직 도입.  
* **삭제할 로드맵:**  
  * 스와이프 기반 매칭, 종교 필터, 진지한 만남 모드. (v2 기획 방향과 불일치)

---

**\[첨부파일 코드 요약\]**

* `find_friend_repository.dart`, `find_friend_detail_screen.dart`, `friend_request_model.dart`: '친구 요청(Friend Request)' 및 'pending' 상태 관리 로직이 핵심. \-\> **신규 기획에서는 이 로직이 삭제되고 ChatService로 즉시 연결됩니다.**  
* `findfriend_form_screen.dart`, `findfriend_edit_screen.dart`: `isDatingProfile`, `age`, `gender`, `genderPreference` 등 데이팅 앱 필드 수집. \-\> **신규 기획에서는 이 스크린들이 축소되거나, `my_bling/screens/profile_edit_screen.dart`와 통합되어야 합니다.**  
* `find_friends_screen.dart`, `findfriend_card.dart`: 현재 리스트업 및 카드 UI. \-\> **신규 기획에서는 `locationParts` 및 `interests` 기반으로 정렬 로직이 변경되어야 합니다.**

**'동네 친구' 최종 리팩토링 계획 (v2.1)**

(작업 수행:4의 v2 계획 \+ G-plan의 우수 아이디어 통합)

#### **1\. 핵심 방향 (v2 유지)**

* **'연인 찾기(Pacar)' 완전 제거:** G-plan의 '데이팅 토글' 제안을 **폐기**합니다. 이는 (목적 1\) 부작용 방지 및 (목적 2\) 단순 대화 유입 목적에 정면으로 위배됩니다.  
* **'친구 요청/수락' 흐름 완전 제거:** G-plan의 `friend_requests` 컬렉션 유지 제안을 **폐기**합니다. '요청'의 존재 자체가 (목적 2\) '부담 없는 대화'의 가장 큰 장벽입니다.  
* **'즉시 대화 시작' 도입:** 기존 `find_friend_detail_screen.dart`의 FAB를 '대화 시작하기'로 변경하며, 클릭 시 수락 과정 없이 즉시 `ChatService`를 통해 1:1 채팅방을 개설합니다.

#### **2\. 데이터 모델 (v2 유지)**

* `friend_requests` 컬렉션: **삭제**합니다.  
* `users` 컬렉션: `isDatingProfile`, `genderPreference`, `ageRange` 등 데이팅 앱 관련 필드를 **삭제**합니다.  
* `findfriend_form_screen.dart` / `findfriend_edit_screen.dart`: **폐기**합니다. 프로필 관리는 `my_bling/screens/profile_edit_screen.dart`로 통합하고, '동네 친구 리스트에 나를 노출(isVisibleInList)' 토글만 추가합니다.

#### **3\. 매칭 로직 (v2.1 개선)**

* (목적 3\) 하이퍼로컬 및 리얼 휴머니티 강화를 위해 G-plan의 '신호' 개념을 도입합니다.  
* **정렬 순서:**  
  1. **1순위 (지역):** `locationParts` (Kel/Kec/Kab) 일치 여부.  
  2. **2순위 (신뢰/활동):** \[G-plan 아이디어 적용\] `trustLevel` (신뢰 등급) 및 '커뮤니티 활동 신호'(예: Local News, POM 최근 활동)를 가중치로 사용.  
  3. **3순위 (관심사):** 공통 `interests` (관심사).

#### **4\. 안전 장치 및 UX (v2.1 개선)**

* (목적 1\) 부작용 방지를 위해 G-plan의 강력한 안전장치를 도입합니다.  
* **\[신규\] 24시간 보호 모드 (G-plan 적용):**  
  * '대화 시작하기'로 열린 신규 채팅방에서는 첫 24시간 동안 **링크 및 전화번호를 마스킹**하고, **이미지는 블러(Blur)** 처리합니다. (이는 작업 4의 '최초 1회 메시지 필터링'보다 강력한 조치입니다.)  
* **\[신규\] 아이스브레이커 (G-plan 적용):**  
  * (목적 2\) 단순 대화 지원을 위해, 신규 채팅방 상단에 "주말에 이 동네에서 뭐 하세요?" 같은 '아이스브레이커' 추천 질문 3개를 표시합니다.  
* **스팸 방지 (v2 유지):**  
  * 일일 '신규' 대화 시작 횟수를 제한합니다. (Cloud Function으로 카운트)

